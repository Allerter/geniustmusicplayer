#:import rgba kivy.utils.get_color_from_hex
#: include kv/start_page.kv
<ScaleLabel@MDLabel>:
    text_size: self.width, None
    _scale: 1. if self.texture_size[1] < self.height else float(self.height) / self.texture_size[1]
    canvas.before:
        PushMatrix
        Scale:
            origin: self.center
            x: self._scale or 1.
            y: self._scale or 1.
    canvas.after:
        PopMatrix
# ----------------- Main Page -----------------
<MainPage>:
    playback_slider: playback_slider
    play_button: play_button
    favorite_button: favorite_button
    volume_slider: volume_slider
    song: None

    ScaleLabel:
        id: title
        text: ''
        pos_hint: {'center_x': .5, 'center_y': 0.95}
        font_style: "H5"
        halign: "center"
    ScaleLabel:
        id: artist
        text: ''
        pos_hint: {'center_x': .5, 'center_y': 0.90}
        font_style: "Subtitle1"
        halign: "center"

    # Volume
    MDIconButton:
        pos_hint: {'center_y': 0.85}
        pos: volume_slider.pos[0] - 30, self.pos[1]
        icon: "volume-medium" if volume_slider.value != 0 else "volume-mute"
        on_release: volume_slider.value = 0.0 if volume_slider.value != 0 else volume_slider.last_value
    VolumeSlider:
        id: volume_slider
        size_hint: 0.8, 0.15
        pos_hint: {'center_x': 0.5, 'center_y': 0.85}
    MDIcon:
        pos_hint: {'center_y': 0.85}
        pos: volume_slider.pos[0] + volume_slider.size[0] - 6, self.pos[1]
        icon: "volume-high"

    # Cover Art
    AsyncImage:
        id: cover_art
        source: 'images/empty_coverart.png'
        pos_hint: {'center_x': .5, 'center_y': 0.55}
        size_hint_y: 0.5
        anim_delay: 0
        allow_stretch: True
        size: root.size[0], root.size[1]
    # Playback Progress
    # GridLayout:
    # pos_hint: {'center_x': .5, 'center_y': .2}
    # size_hint_y: None
    MDLabel:
        id: track_current
        text: '0:00'
        size_hint: 0.1, None
        pos_hint: {'center_y': 0.25}
        pos: root.playback_slider.pos[0] - 30, self.pos[1]
    PlaybackSlider:
        id: playback_slider
    MDLabel:
        id: track_length
        text: ''
        size_hint: 0.1, None
        pos_hint: {'center_y': 0.25}
        pos: root.playback_slider.pos[0] + root.playback_slider.size[0], self.pos[1]

    # Playlist
    MDIconButton:
        id: playlist_button
        icon: 'playlist-music'
        user_font_size: '35sp'
        pos_hint: {'center_x': 0.1, 'center_y': 0.1}
        on_release: root.playlist_menu.open()

    # Playback Controls
    MDIconButton:
        id: previous_button
        icon: 'skip-previous'
        user_font_size: '35sp'
        pos_hint: {'center_x': 0.3, 'center_y': 0.1}
        on_release: play_button.play_previous(self)
    PlayButton:
        id: play_button
        # size_hint: .2, .2
        pos_hint: {'center_x': 0.5, 'center_y': 0.11}
        icon: 'play-outline'
        user_font_size: '50sp'
        allow_stretch: True
        theme_text_color: "Custom"
        text_color: app.theme_cls.primary_color if app.theme_cls.theme_style == 'Light' else app.theme_cls.accent_color
        source: 'images/play2.png'
        # on_press: print(self.id)
    MDIconButton:
        id: next_button
        icon: 'skip-next'
        user_font_size: '35sp'
        pos_hint: {'center_x': 0.7, 'center_y': 0.1}
        on_release: play_button.play_next(self)
    FavoriteButton:
        id: favorite_button
        size_hint: None, None
        user_font_size: '35sp'
        pos_hint: {'center_x': 0.9, 'center_y': 0.1}
        theme_text_color: "Custom"
        text_color: rgba('#ff0000') if app.theme_cls.theme_style == 'Light' else rgba('#cc0000')

<PlaybackSlider>:
    min: 0
    value: 0
    hint: True
    size_hint: 0.8, None
    pos_hint: {'center_x': 0.5, 'center_y': 0.25}

<VolumeSlider>:
    min: 0
    max: 100
    value: app.volume
    hint: False
    orientation: 'horizontal'

<PlayButton>

<ImageButton@MDIconButton>

<FavoriteButton>

<RightContentCls>
    MDIconButton:
        icon: 'close-box'
        user_font_size: "16sp"
        pos_hint: {"center_y": .5}
        on_release: app.main_page.remove_playlist_item(root)
